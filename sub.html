<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bubu Bot Premium</title>
  <meta name="color-scheme" content="dark">
  <meta name="theme-color" content="#5865F2">
  <style>
    :root{
      --bg:#323339; --card:#393a41; --text:#ffffff; --muted:#b7bbc6;
      --line:#4a4c55; --btn:#5865F2; --btnText:#fff;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .card{
      width:min(760px,100%);
      background:var(--card);
      border-radius:16px;
      box-shadow:0 8px 30px rgba(0,0,0,.35);
      padding:24px;
    }
    .header{display:flex; align-items:center; gap:12px; margin-bottom:8px;}
    .bubu-logo{
      width:30px; height:30px; border-radius:6px; object-fit:contain;
      padding:2px; margin-left:2px;
    }
    h1{font-size:22px; margin:0}
    h2{font-size:18px; margin:8px 0 4px}
    .muted{color:var(--muted)}
    .divider{height:1px; background:var(--line); margin:14px 0}
    .list{display:grid; gap:10px; margin:10px 0 0}
    .row{display:flex; gap:10px; align-items:flex-start}
    .row b{color:#fff}
    .cta{margin-top:20px; display:flex; justify-content:center; flex-wrap:wrap; gap:10px}
    a.btn{
      border:0; border-radius:12px; padding:14px 22px; font-weight:700;
      background:var(--btn); color:var(--btnText); text-decoration:none;
      display:inline-flex; align-items:center; gap:10px; font-size:16px;
      transition:opacity .2s ease;
    }
    a.btn.disabled{ opacity:.5; pointer-events:none; filter:grayscale(25%); }
    .logo{width:22px; height:22px; filter:invert(1)}
    .footer{margin-top:20px; text-align:center; color:var(--muted); font-size:14px;}
    .note{margin-top:10px; font-size:14px; color:var(--muted); text-align:center}
    .hidden{display:none}
    .copy{
      display:block; width:100%; background:#2a2c32; color:#e6e8ee;
      border:1px solid var(--line); border-radius:8px; padding:10px 12px;
      word-break:break-all; font:13px ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
    }
    .small-actions{display:flex; gap:10px; justify-content:center; margin-top:10px}
    button.minibtn, a.minibtn{
      background:#2f3136; color:#d7dbe6; border:0; border-radius:8px; padding:8px 12px; cursor:pointer; text-decoration:none;
    }

    /* bottom-right bouncing arrow hint for Discord IAB tool bar */
    .arrow-hint {
      position: fixed; right: 18px; bottom: 96px;
      font-size: 28px; user-select:none; pointer-events:none; opacity:.9;
      animation:bubu-bounce 1s infinite;
      filter: drop-shadow(0 2px 6px rgba(0,0,0,.6));
    }
    @keyframes bubu-bounce {
      0%,100% { transform: translateY(0) }
      50%     { transform: translateY(-7px) }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="header">
      <img src="smallbubulogo.png" alt="Bubu Logo" class="bubu-logo">
      <h1>Bubu Bot Premium</h1>
    </div>
    <h2>Get the Full Bubu Experience</h2>
    <div class="muted">Unlimited fun ‚Ä¢ Exclusive rewards ‚Ä¢ Rare collectibles</div>

    <div class="divider"></div>

    <div class="muted">Here‚Äôs what Premium includes:</div>
    <div class="list">
      <div class="row">üéÆ <div><b>Unlimited Gameplay</b> ‚Äî Play all BubuBot games with no hourly or daily limits.</div></div>
      <div class="row">üí∞ <div><b>Bigger Multipliers & Rewards</b> ‚Äî Higher payouts and bonus multipliers across every game.</div></div>
      <div class="row">üëú <div><b>Rare Accessories & Collectibles</b> ‚Äî Unlock premium-only Bubus and outfits.</div></div>
      <div class="row">üéÅ <div><b>Future Giveaways</b> ‚Äî Automatic entry into monthly giveaways with real prizes.</div></div>
      <div class="row">üöÄ <div><b>Early Access to New Games</b> ‚Äî Play new modes and seasonal events early.</div></div>
    </div>

    <div class="divider"></div>

    <!-- Single CTA -->
    <div class="cta">
      <a id="subscribeBtn" class="btn" href="#">
        <img class="logo" src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/discord.svg" alt="Discord">
        Subscribe via Discord
      </a>
    </div>

    <!-- In-app (Discord) guidance -->
    <div id="inAppNote" class="note hidden">
      You‚Äôre inside the Discord app. Tap the <b>browser</b> icon (bottom-right) to open this page in Safari/Chrome, then subscribe.
    </div>
    <div id="arrowHint" class="arrow-hint hidden" aria-hidden="true">‚Üó</div>

    <!-- Post-login fallback (if ever needed) -->
    <div id="openBrowserBlock" class="hidden">
      <div class="note">If the product doesn‚Äôt open here, use your browser:</div>
      <code id="skuLink" class="copy"></code>
      <div class="small-actions">
        <button id="copySku" class="minibtn">Copy Link</button>
        <a id="openSku" class="minibtn" href="#" rel="noopener">Open in Browser</a>
      </div>
    </div>

    <div class="footer">You‚Äôll complete your subscription securely through Discord.</div>
  </div>

  <script>
    // ====== CONFIG ======
    const APP_ID = "1421896407140536401";
    const SKU_ID = "1427920614915702806";
    const REDIRECT_URI = "https://bububot.dev/sub.html";   // must be added in Dev Portal ‚Üí OAuth2 Redirects
    const STORE_URL = `https://discord.com/discovery/applications/${APP_ID}/store/${SKU_ID}`;

    // OAuth (identify only) ‚Äî ensures discord.com session in real browsers
    const OAUTH_URL = `https://discord.com/oauth2/authorize`
      + `?client_id=${APP_ID}`
      + `&redirect_uri=${encodeURIComponent(REDIRECT_URI)}`
      + `&response_type=code`
      + `&scope=identify`
      + `&state=bubu_premium`
      + `&prompt=consent`;

    // ====== DETECT ENV ======
    const ua = navigator.userAgent;
    const isMobile = /iPhone|iPad|iPod|Android/i.test(ua);
    const isDiscordIAB = /\bDiscord\b/i.test(ua); // Discord in-app browser

    // ====== ELEMENTS ======
    const subBtn = document.getElementById("subscribeBtn");
    const inAppNote = document.getElementById("inAppNote");
    const arrowHint = document.getElementById("arrowHint");
    const openBlock = document.getElementById("openBrowserBlock");
    const skuLink = document.getElementById("skuLink");
    const openSku = document.getElementById("openSku");
    const copySku = document.getElementById("copySku");

    // ====== GATE THE CTA ======
    if (isMobile && isDiscordIAB) {
      // Inside Discord app webview ‚Äî disable the CTA and guide user to open in browser
      subBtn.classList.add("disabled");
      subBtn.setAttribute("aria-disabled", "true");
      subBtn.addEventListener("click", e => e.preventDefault());
      inAppNote.classList.remove("hidden");
      arrowHint.classList.remove("hidden");

      // Provide copy/open helpers just in case
      openBlock.classList.remove("hidden");
      skuLink.textContent = STORE_URL;
      openSku.href = STORE_URL;
      copySku?.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(STORE_URL);
          copySku.textContent = "Copied!";
          setTimeout(() => (copySku.textContent = "Copy Link"), 1400);
        } catch {}
      });
    } else {
      // Real browser (desktop or mobile): enable login-first flow
      subBtn.classList.remove("disabled");
      subBtn.removeAttribute("aria-disabled");
      subBtn.href = OAUTH_URL;
      inAppNote.classList.add("hidden");
      arrowHint.classList.add("hidden");
    }

    // ====== AFTER OAUTH (real browser only) ======
    (function handleOAuthReturn(){
      const params = new URLSearchParams(location.search);
      const code = params.get("code");
      const error = params.get("error");
      if (error || !code) return;

      // Clean URL so refreshes don't loop
      try {
        history.replaceState({}, "", location.origin + location.pathname);
      } catch {}

      // Now that user is authenticated in a real browser, open the SKU
      window.location.replace(STORE_URL);
    })();
  </script>
</body>
</html>
